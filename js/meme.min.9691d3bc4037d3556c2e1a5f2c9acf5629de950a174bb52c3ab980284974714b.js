const throttle=(e,t)=>{let s,o,n;return function(){const i=this,a=arguments;s?(clearTimeout(o),o=setTimeout(function(){Date.now()-n>=t&&(e.apply(i,a),n=Date.now())},Math.max(t-(Date.now()-n),0))):(e.apply(i,a),n=Date.now(),s=!0)}},delayTime=420;window.addEventListener("DOMContentLoaded",e=>{const t=document.querySelector(".header");if(t){const e=window.getComputedStyle(t,null).getPropertyValue("height");document.documentElement.style.setProperty("--header-height",e)}},{once:!0}),window.addEventListener("DOMContentLoaded",e=>{const n=document.querySelector(".nav-toggle"),o=document.createElement("div");o.className="nav-toggle-inner",n.appendChild(o);for(let e=0;e<3;e++){const t=document.createElement("span");o.appendChild(t)}const s=document.getElementById("nav-toggle"),t=document.querySelector(".header"),i=document.querySelector(".nav-curtain");s.addEventListener("change",e=>{e.target.checked?(t.classList.add("open"),n.classList.add("open"),t.classList.remove("fade"),i.style="display: block"):(t.classList.remove("open"),n.classList.remove("open"),t.classList.add("fade"))}),i.addEventListener("animationend",e=>{s.checked||e.target.removeAttribute("style")}),window.addEventListener("scroll",throttle(function(){l()},delayTime));const r=window.getComputedStyle(document.documentElement,null).getPropertyValue("--max-width");let c=window.matchMedia(`(max-width: ${r})`);c.addListener(e=>{e.matches||a(!0)});function l(){const e=document.getElementById("search-input");if(e&&e===document.activeElement)return;a()}function a(e){s.checked&&(s.checked=!1,t.classList.remove("open"),n.classList.remove("open"),e?i.removeAttribute("style"):t.classList.add("fade"))}},{once:!0}),window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("back-to-top");t!==null&&window.addEventListener("scroll",throttle(function(){window.scrollY>100?t.classList.add("show"):t.classList.remove("show")},delayTime))},{once:!0});const userPrefers=localStorage.getItem("theme");userPrefers==="dark"?changeModeMeta("dark"):userPrefers==="light"&&changeModeMeta("light"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{changeMode()}),window.addEventListener("DOMContentLoaded",()=>{changeMode();const e=document.getElementById("theme-switcher");e&&e.addEventListener("click",e=>{e.preventDefault(),changeModeMeta(getCurrentTheme()=="dark"?"light":"dark"),changeMode(),storePrefers()})},{once:!0}),window.addEventListener("storage",function(e){if(e.key!=="theme")return;changeModeMeta(e.newValue==="dark"?"dark":"light"),changeMode()});function getCurrentTheme(){return JSON.parse(window.getComputedStyle(document.documentElement,null).getPropertyValue("--theme-name"))}function changeModeMeta(e){document.documentElement.setAttribute("data-theme",e)}function changeMode(){const e=getCurrentTheme()==="dark",t=e?"#16171d":"#F3F3F8";if(document.querySelector('meta[name="theme-color"]').setAttribute("content",t),typeof mermaidConfig!="undefined"){const t=document.querySelectorAll(".mermaid");t.forEach(e=>{e.getAttribute("data-processed")?(e.removeAttribute("data-processed"),e.innerHTML=e.getAttribute("data-graph")):e.setAttribute("data-graph",e.textContent)}),e?(mermaidConfig.theme="dark",mermaid.initialize(mermaidConfig),mermaid.init()):(mermaidConfig.theme="default",mermaid.initialize(mermaidConfig),mermaid.init())}}function storePrefers(){window.localStorage.setItem("theme",getCurrentTheme())}window.addEventListener("DOMContentLoaded",e=>{const t="复制",s="已复制";document.querySelectorAll(".post-body > pre").forEach(e=>{const t=document.createElement("div");e.parentNode.replaceChild(t,e),t.appendChild(e)});function n(e){const n=document.querySelectorAll("table.lntable, .highlight > pre, .post-body > div > pre");n.forEach(n=>{n.parentNode.style.position="relative";const o=document.createElement("button");o.className="copy-button",o.type="button",o.innerText=t;let i;n.classList.contains("lntable")?i=n.querySelectorAll(".lntd")[1]:i=n.querySelector("code"),o.addEventListener("click",()=>{e.writeText(i.innerText).then(()=>{o.blur(),o.innerText=s,setTimeout(()=>{o.innerText=t},1e3)}).catch(e=>{o.innerText="Error",console.error(e)})}),n.appendChild(o),n.parentNode.addEventListener("mouseover",()=>{o.style="visibility: visible; opacity: 1"}),n.parentNode.addEventListener("mouseout",()=>{o.style="visibility: hidden; opacity: 0"})})}if(navigator&&navigator.clipboard)n(navigator.clipboard);else{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/clipboard-polyfill@2.8.6/dist/clipboard-polyfill.min.js",e.defer=!0,e.onload=function(){n(clipboard)},document.head.appendChild(e)}},{once:!0}),document.addEventListener("DOMContentLoaded",function(){const f=document.getElementById("popup-btn"),t=document.getElementById("popup-overlay"),n=document.getElementById("popup-content"),h=document.getElementById("popup-close"),e=document.getElementById("popup-window"),c=document.getElementById("popup-header");async function m(){try{const e=await fetch("/static/neko.md"),t=await e.text();n.innerHTML=marked.parse(t)}catch(e){n.innerHTML="<p>内容加载失败，请稍后再试。</p>",console.error("加载失败:",e)}}f.addEventListener("click",function(){m(),t.style.display="block",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}),h.addEventListener("click",function(){t.style.display="none"}),t.addEventListener("click",function(e){e.target===t&&(t.style.display="none")}),n.addEventListener("touchmove",function(e){e.stopPropagation()}),t.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1});let s=!1,d,u,o,i;function a(t,n){s=!0,d=t,u=n;const a=e.getBoundingClientRect();o=a.left,i=a.top,e.style.transform="none",e.style.left=`${o}px`,e.style.top=`${i}px`}function l(t,n){if(s){const s=t-d,a=n-u;e.style.left=`${o+s}px`,e.style.top=`${i+a}px`}}function r(){s=!1}c.addEventListener("mousedown",e=>a(e.clientX,e.clientY)),document.addEventListener("mousemove",e=>l(e.clientX,e.clientY)),document.addEventListener("mouseup",r),c.addEventListener("touchstart",e=>a(e.touches[0].clientX,e.touches[0].clientY)),document.addEventListener("touchmove",e=>l(e.touches[0].clientX,e.touches[0].clientY)),document.addEventListener("touchend",r)})